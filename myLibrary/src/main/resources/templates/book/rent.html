<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<main layout:fragment="content" class="main">

    <div class="container">
        <h2>책 대여</h2>

        <div class="book-details">
            <!-- 선택한 책의 정보 표시 -->
            <h3>책 제목: <span th:text="${book.bookName}"></span></h3>
            <p>저자: <span th:text="${book.bookAuthor}"></span></p>
            <p>출판사: <span th:text="${book.bookPublisher}"></span></p>
            <p>소개: <span th:text="${book.bookIntro}"></span></p>
            <p>출판 일자: <span th:text="${book.bookPubDate}"></span></p>
            <!-- 대여 상태와 날짜 표시 -->
            <p>대여 상태: <span th:text="${book.bookRent != null ? book.bookRent.rentStatus : '없음'}"></span></p>
            <p>대여 날짜: <span th:text="${book.bookRent != null ? book.bookRent.rentDate : '없음'}"></span></p>
        </div>

        <form id="rentForm" method="post" th:action="@{/updateRent}">
            <!-- 책 ID를 전송 -->
            <input type="hidden" name="bookId" th:value="${book.bookId}" />

            <!-- 사용자의 ID를 세션에서 가져옵니다. -->
            <input type="hidden" name="id" th:value="${id}" />

            <!-- 대여 상태를 전송 -->
            <input type="hidden" name="rentStatus" th:value="${book.bookRent != null ? book.bookRent.rentStatus : ''}" />

            <!-- 대여 상태에 따라 대여 버튼 활성화 여부 결정 -->
            <button type="submit" class="btn btn-primary"
                    th:disabled="${book.bookRent != null}">대여하기</button>
        </form>

        <!-- 이전 페이지로 돌아가기 위한 버튼 -->
        <a th:href="@{/list}" class="btn btn-secondary">목록으로 돌아가기</a>

    </div>

</main>

<!-- 각 페이지의 JS가 작성될 위치지정 -->
<th:block layout:fragment="script">
    <script th:src="@{plugins/ckeditor5/build/ckeditor.js}"></script>

    <script th:inline="javascript">
        function beforeSubmit() {
            const f = document.postForm;

            if(f.bookName.value == '') {
                alert('제목을 등록해주세요.');
                return;
            }

            f.submit(); //전송
        }
    </script>
</th:block>

</html>